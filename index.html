<!DOCTYPE html>
<html lang="en" >
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OwaSchool Telepropter </title>  
</head>
    
    
    
    
<body> 
<style>html, body{ width: 100%; height: 100%; padding: 0; margin: 0; background-color:#222; font-size: 0; }
h1{width: 100%;font-family: sans-serif;position:relative;text-align:center;color:white;font-size: 18px;
opacity: 1;transition: opacity 1s ease-in-out; -moz-transition: opacity 1s ease-in-out; -webkit-transition: opacity 1s ease-in-out;}
h1 a{color: #48b1f4;text-decoration:none;}
.owa_script{ color: #fff; display: block; width: -webkit-fill-available; height: 100%;padding: 0;margin: 0;position: relative;font-size: 40px;background: #000;}
svg{display: block;width: 100%;height: 40px;padding: 0;margin: 0;position: relative;background-color: #26118f;}
path{stroke-linecap: square;stroke: white;stroke-width: 0.5px;}
.flipclass{   -moz-transform: scale(1, -1); -webkit-transform: scale(1, -1); -o-transform: scale(1, -1); -ms-transform: scale(1, -1); transform: scale(-1, 1);}    
</style>
    
<script src="https://code.jquery.com/jquery-3.5.0.js"></script>

<script>
// Create the root video element
var video = document.createElement('video');
video.setAttribute('loop', '');
// Add some styles if needed
video.setAttribute('style', 'position: fixed;');
// A helper to add sources to video
function addSourceToVideo(element, type, dataURI) {
    var source = document.createElement('source');
    source.src = dataURI;
    source.type = 'video/' + type;
    element.appendChild(source);
}
// A helper to concat base64
var base64 = function(mimeType, base64) {
    return 'data:' + mimeType + ';base64,' + base64;
};

// Add Fake sourced
addSourceToVideo(video,'webm', base64('video/webm', 'GkXfo0AgQoaBAUL3gQFC8oEEQvOBCEKCQAR3ZWJtQoeBAkKFgQIYU4BnQI0VSalmQCgq17FAAw9CQE2AQAZ3aGFtbXlXQUAGd2hhbW15RIlACECPQAAAAAAAFlSua0AxrkAu14EBY8WBAZyBACK1nEADdW5khkAFVl9WUDglhohAA1ZQOIOBAeBABrCBCLqBCB9DtnVAIueBAKNAHIEAAIAwAQCdASoIAAgAAUAmJaQAA3AA/vz0AAA='));
addSourceToVideo(video, 'mp4', base64('video/mp4', 'AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAAG21kYXQAAAGzABAHAAABthADAowdbb9/AAAC6W1vb3YAAABsbXZoZAAAAAB8JbCAfCWwgAAAA+gAAAAAAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAIVdHJhawAAAFx0a2hkAAAAD3wlsIB8JbCAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAIAAAACAAAAAABsW1kaWEAAAAgbWRoZAAAAAB8JbCAfCWwgAAAA+gAAAAAVcQAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAAAVxtaW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAEcc3RibAAAALhzdHNkAAAAAAAAAAEAAACobXA0dgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAIAAgASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAAFJlc2RzAAAAAANEAAEABDwgEQAAAAADDUAAAAAABS0AAAGwAQAAAbWJEwAAAQAAAAEgAMSNiB9FAEQBFGMAAAGyTGF2YzUyLjg3LjQGAQIAAAAYc3R0cwAAAAAAAAABAAAAAQAAAAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAAAEwAAAAEAAAAUc3RjbwAAAAAAAAABAAAALAAAAGB1ZHRhAAAAWG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAK2lsc3QAAAAjqXRvbwAAABtkYXRhAAAAAQAAAABMYXZmNTIuNzguMw=='));

// Append the video to where ever you need
document.body.appendChild(video);

// Start playing video after any user interaction.
// NOTE: Running video.play() handler without a user action may be blocked by browser.
var playFn = function() {
    video.play();
    document.body.removeEventListener('touchend', playFn);
};
document.body.addEventListener('touchend', playFn);
	
	
	
function readURL(input, owaschool_area) {  if (input.files && input.files[0]) {  
var reader = new FileReader();
reader.onload = function (e) {
var textArea = document.getElementById(owaschool_area);
textArea.value = e.target.result;
};         
input_owaschool = input.files[0]             
reader.readAsText(input_owaschool); } 
                                      }  
    

function owa_fontsize(fontsize){
    document.getElementById("owa_script_scrool").style.fontSize= fontsize.value+ "px";
}
    
function flipstyle(){
    $("#owa_script_scrool").toggleClass('flipclass');
    var msg = $("#owa_script_scrool").val().replace(/\n/g, "");
    $("#owa_script_scrool").val(msg);
}
    
window.onload = function () {
    "use strict";
    var paths = document.getElementsByTagName('path');
    var visualizer = document.getElementById('visualizer');
    var mask = visualizer.getElementById('mask');
    var h = document.getElementsByTagName('h1')[0];
    var path;
    var report = 0;
          
  const handleSuccess = function(stream) {
   //Audio stops listening in FF without // window.persistAudioStream = stream;
        //https://bugzilla.mozilla.org/show_bug.cgi?id=965483
        //https://support.mozilla.org/en-US/questions/984179
        window.persistAudioStream = stream;
        h.innerHTML = "<a href='https://www.youtube.com/owaschool'>Owaschool Telepropter</a>";
        h.setAttribute('style', 'opacity: 0.50;');
        var audioContent = new AudioContext();
        var audioStream = audioContent.createMediaStreamSource( stream );
        var analyser = audioContent.createAnalyser();
        audioStream.connect(analyser);
        analyser.fftSize = 1024;

        var frequencyArray = new Uint8Array(analyser.frequencyBinCount);
        visualizer.setAttribute('viewBox', '0 0 255 255');
      
      
				//Through the frequencyArray has a length longer than 255, there seems to be no
        //significant data after this point. Not worth visualizing.
        for (var i = 0 ; i < 255; i++) {
            path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('stroke-dasharray', '4,1');
            mask.appendChild(path);
        }
        var doDraw = function () {
          setTimeout(function(){   
            requestAnimationFrame(doDraw);
            analyser.getByteFrequencyData(frequencyArray);
          	var adjustedLength;
            
      var owa_scrlsp = document.getElementById('owa_scrool_speed').value;
        var owafr = document.getElementById('owa_frequency').value; 
            
            
         
    
            
            for (var i = 0 ; i < 200; i++) {
              	adjustedLength = Math.floor(frequencyArray[i]) - (Math.floor(frequencyArray[i]) % 5);
                paths[i].setAttribute('d', 'M '+ (i) +',255 l 0,-' + adjustedLength);
                if( adjustedLength > parseInt(owafr)){
            $("#owa_script_scrool").scrollTop($("#owa_script_scrool").scrollTop() + parseInt(owa_scrlsp)); 
              break;
                }
            }
        
            
            }, 25);        
            
            

        }
        doDraw();
      
      
  }; 

    
 
  navigator.mediaDevices.getUserMedia({ audio: true, video: false })
      .then(handleSuccess);


};
    
    
    
    
    
    </script>
    
       

  <h1><a href="https://www.youtube.com/owaschool">please allow the use of your microphone </a></h1>
    
    
<div class="" style="display: flex;">
<input type="file" onchange="readURL(this, 'owa_script_scrool');" style="width: 20%;display: inline-block;height: 30px; background:#fff; " >
<input id="owa_scrool_speed" placeholder="1" value="1" type="text" style="width: 20%;display: inline-block;height: 25px;"> 
<input id="owa_frequency" placeholder="180" value="180" type="text" style="width: 20%;display: inline-block;">  
<input onchange="owa_fontsize(this)" placeholder="40" value="40" type="text" style="width: 20%;display: inline-block;"> 
 <input value="flip Text" type="button" style="width: 20%;display: inline-block;" onclick="flipstyle()" >     
    

    

   
    
    
</div>
    
    
    
<svg preserveAspectRatio="none" id="visualizer" style="display:none;" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<defs>
<mask id="mask"><g id="maskGroup"></g></mask>
<linearGradient id="gradient" x1="0%" y1="0%" x2="0%" y2="100%">
<stop offset="0%" style="stop-color:#ff0a0a;stop-opacity:1" />
<stop offset="20%" style="stop-color:#f1ff0a;stop-opacity:1" />
<stop offset="90%" style="stop-color:#d923b9;stop-opacity:1" />
<stop offset="100%" style="stop-color:#050d61;stop-opacity:1" />
</linearGradient>
</defs>
<rect x="0" y="0" width="100%" height="100%" fill="url(#gradient)" mask="url(#mask)"></rect>
</svg>  
    
 <div class="owa_script" ><textarea class="owa_script owa_script_scrool" id="owa_script_scrool" style="margin-left: 25px;" >Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here... Past Your Script here...  </textarea >  </div>
    
    
    
    
    
    
    
    
    
    

</body>
</html>
